<!-- templates/quick_booking.html -->
{% extends 'base.html' %}

{% block content %}
<section class="hero-section">
    <div class="container">
        <h1 class="hero-title">Quick Booking</h1>
        <p class="hero-subtitle">Find and book your perfect room in seconds</p>
    </div>
</section>

<section style="padding: 2rem 0;">
    <div class="container">
        <div class="quick-booking">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 2rem; color: white;">Check Availability</h2>
                <form method="get" action="{% url 'quick_booking' %}">
                    <div class="booking-form-grid">
                        <div class="booking-form-group">
                            <label class="filter-label" style="color: white;">Check-in Date</label>
                            <input type="date" name="check_in" class="booking-input" value="{{ check_in }}" required>
                        </div>
                        <div class="booking-form-group">
                            <label class="filter-label" style="color: white;">Check-out Date</label>
                            <input type="date" name="check_out" class="booking-input" value="{{ check_out }}" required>
                        </div>
                        <div class="booking-form-group">
                            <label class="filter-label" style="color: white;">Number of Guests</label>
                            <select name="guests" class="booking-input">
                                <option value="1" {% if guests == "1" %}selected{% endif %}>1 Guest</option>
                                <option value="2" {% if guests == "2" %}selected{% endif %}>2 Guests</option>
                                <option value="3" {% if guests == "3" %}selected{% endif %}>3 Guests</option>
                                <option value="4" {% if guests == "4" %}selected{% endif %}>4 Guests</option>
                                <option value="5" {% if guests == "5" %}selected{% endif %}>5+ Guests</option>
                            </select>
                        </div>
                        <div class="booking-form-group">
                            <button type="submit" class="booking-btn">Check Availability</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {% if check_in and check_out %}
        <div class="results-info">
            <div>
                <strong>{{ room_types.count }}</strong> rooms available for {{ guests }} guest{{ guests|pluralize }}
            </div>
            <div>
                <label class="filter-label">Sort by:</label>
                <select class="sort-select" onchange="sortRooms(this.value)">
                    <option value="price_low">Price: Low to High</option>
                    <option value="price_high">Price: High to Low</option>
                    <option value="capacity">Capacity</option>
                    <option value="name">Name</option>
                </select>
            </div>
        </div>
        {% endif %}

        <div class="room-grid">
            {% for room_type in room_types %}
            <div class="room-card" data-price="{{ room_type.price_per_night }}" data-capacity="{{ room_type.capacity }}" data-name="{{ room_type.name }}">
                <div class="room-image">
                    {% if room_type.name == 'Standard Room' %}
                    <img src="https://images.unsplash.com/photo-1631049307264-da0ec9d70304?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80" alt="Standard Room">
                    {% elif room_type.name == 'Deluxe Room' %}
                    <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80" alt="Deluxe Room">
                    {% elif room_type.name == 'Executive Suite' %}
                    <img src="https://images.unsplash.com/photo-1611892440504-42a792e24d32?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80" alt="Executive Suite">
                    {% elif room_type.name == 'Presidential Suite' %}
                    <img src="https://images.unsplash.com/photo-1590490360182-c33d57733427?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80" alt="Presidential Suite">
                    {% endif %}
                </div>
                <div class="room-content">
                    <h3 class="room-title">{{ room_type.name }}</h3>
                    <p style="color: #666; margin-bottom: 1rem;">{{ room_type.description|truncatewords:15 }}</p>
                    <div class="room-features">
                        <span style="font-weight: bold; color: #e74c3c;">${{ room_type.price_per_night }}/night</span>
                        <span style="color: #666;">Capacity: {{ room_type.capacity }}</span>
                    </div>
                    <a href="{% url 'room_detail' room_type.id %}" class="btn" style="width: 100%; text-align: center; margin-top: 1rem;">Select Room</a>
                </div>
            </div>
            {% empty %}
            {% if check_in and check_out %}
            <div style="text-align: center; grid-column: 1 / -1; padding: 3rem;">
                <h3>No rooms available for your selected criteria.</h3>
                <p>Please try different dates or number of guests.</p>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</section>

<script>
function sortRooms(sortBy) {
    const roomGrid = document.querySelector('.room-grid');
    const rooms = Array.from(roomGrid.querySelectorAll('.room-card'));
    
    rooms.sort((a, b) => {
        switch(sortBy) {
            case 'price_low':
                return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
            case 'price_high':
                return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
            case 'capacity':
                return parseInt(b.dataset.capacity) - parseInt(a.dataset.capacity);
            case 'name':
                return a.dataset.name.localeCompare(b.dataset.name);
            default:
                return 0;
        }
    });
    
    // Clear and re-append sorted rooms
    roomGrid.innerHTML = '';
    rooms.forEach(room => roomGrid.appendChild(room));
}
</script>
{% endblock %}