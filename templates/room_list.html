<!-- templates/room_list.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- Alternative hero section using existing image -->
<section class="hero-section" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{% static 'images/cities/new_york.jpg' %}');">
    <div class="container">
        <h1 class="hero-title">Find Your Perfect Hotel</h1>
        <p class="hero-subtitle">Search and book ABC Hotels in amazing cities around the world</p>
    </div>
</section>

<section style="padding: 2rem 0;">
    <div class="container">
        <!-- Filter Section - All on one line -->
        <div class="filter-section">
            <h3 style="margin-bottom: 1rem;">Search Hotel Locations</h3>
            <form method="get" action="{% url 'room_list' %}">
                <div class="filter-grid-single-line">
                    <div class="filter-group">
                        <label class="filter-label">Destination City</label>
                        <select name="city" class="filter-select" required>
                            <option value="">Select a City</option>
                            {% for city in all_cities %}
                            <option value="{{ city.name }}" {% if selected_city == city.name %}selected{% endif %}>
                                {{ city.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Check-in</label>
                        <input type="date" name="check_in" class="filter-input" value="{{ selected_check_in }}" min="{{ today }}" max="{{ max_check_in_date }}" required>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Check-out</label>
                        <input type="date" name="check_out" class="filter-input" value="{{ selected_check_out }}" min="{{ today }}" max="{{ max_check_out_date }}" required>
                    </div>

                    <!-- Updated Guests dropdown with extended options -->
                    <div class="filter-group">
                        <label class="filter-label">Guests per Room</label>
                        <select name="guests" class="filter-select">
                            <option value="">Any Number</option>
                            <option value="1" {% if selected_guests == "1" %}selected{% endif %}>1 Guest</option>
                            <option value="2" {% if selected_guests == "2" %}selected{% endif %}>2 Guests</option>
                            <option value="3" {% if selected_guests == "3" %}selected{% endif %}>3 Guests</option>
                            <option value="4" {% if selected_guests == "4" %}selected{% endif %}>4 Guests</option>
                            <option value="5" {% if selected_guests == "5" %}selected{% endif %}>5 Guests</option>
                            <option value="6" {% if selected_guests == "6" %}selected{% endif %}>6 Guests</option>
                            <option value="7" {% if selected_guests == "7" %}selected{% endif %}>7 Guests</option>
                            <option value="8" {% if selected_guests == "8" %}selected{% endif %}>8+ Guests</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Number of Rooms</label>
                        <select name="rooms" class="filter-select">
                            <option value="">Any Number</option>
                            <option value="1" {% if selected_rooms == "1" %}selected{% endif %}>1 Room</option>
                            <option value="2" {% if selected_rooms == "2" %}selected{% endif %}>2 Rooms</option>
                            <option value="3" {% if selected_rooms == "3" %}selected{% endif %}>3 Rooms</option>
                            <option value="4" {% if selected_rooms == "4" %}selected{% endif %}>4+ Rooms</option>
                        </select>
                    </div>

                    <div class="filter-group button-group">
                        <button type="submit" class="btn-consistent btn-booking">Search Hotels</button>
                        <a href="{% url 'room_list' %}" class="btn-consistent btn-booking">Clear</a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Only show cities if no specific city is selected -->
        {% if not selected_city %}
        <!-- Popular Destinations Section -->
        <div style="margin-top: 3rem;"> 
            <h2 style="text-align: center; margin-bottom: 2rem; color: #2c3e50;">Popular Destinations</h2>
            
            <div class="city-grid-3col">
                {% for city in cities|slice:":6" %}
                <div class="city-card-3col">
                    <div class="city-image-3col">
                        {% if city.image %}
                        <img src="{{ city.image.url }}" alt="{{ city.name }}">
                        {% else %}
                        <!-- Fallback images for popular cities -->
                        {% if "New York" in city.name %}
                        <img src="{% static 'images/cities/new_york.jpg' %}" alt="ABC New York Hotel">
                        {% elif "London" in city.name %}
                        <img src="{% static 'images/cities/london.jpg' %}" alt="ABC London Hotel">
                        {% elif "Paris" in city.name %}
                        <img src="{% static 'images/cities/paris.jpg' %}" alt="ABC Paris Hotel">
                        {% elif "Tokyo" in city.name %}
                        <img src="{% static 'images/cities/tokyo.jpg' %}" alt="ABC Tokyo Hotel">
                        {% elif "Dubai" in city.name %}
                        <img src="{% static 'images/cities/dubai.jpg' %}" alt="ABC Dubai Hotel">
                        {% elif "Singapore" in city.name %}
                        <img src="{% static 'images/cities/singapore.jpg' %}" alt="ABC Singapore Hotel">
                        {% else %}
                        <img src="{% static 'images/cities/default.jpg' %}" alt="ABC {{ city.name }} Hotel">
                        {% endif %}
                        {% endif %}
                    </div>
                    <div class="city-content-3col">
                        <h3 class="city-title-3col" style="color: #2c3e50; margin: 0 0 0.2rem 0; font-size: 1.1rem;">ABC {{ city.name }} Hotel</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9rem;">{{ city.country }}</p>
                        <p style="color: #666; margin-bottom: 1rem; line-height: 1.5; font-size: 0.9rem;">{{ city.description|truncatewords:15 }}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <strong style="color: #3498db; font-size: 1.2rem;">
                                    {% if city.starting_price %}
                                    ${{ city.starting_price }}
                                    {% else %}
                                    $199
                                    {% endif %}
                                </strong>
                                <span style="color: #666; font-size: 0.8rem;">/night</span>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 0.8rem;">
                                    <strong>{{ city.room_count }}</strong> rooms
                                </div>
                            </div>
                        </div>
                        <a href="{% url 'city_detail' city.id %}" class="btn-consistent btn-booking" style="width: 100%; text-align: center;">View Hotel</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<style>
    /* Filter Section Styles */
    .filter-section {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    /* Single Line Filter Grid */
    .filter-grid-single-line {
        display: flex;
        gap: 1rem;
        align-items: end;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-width: 120px;
    }

    .button-group {
        display: flex;
        gap: 0.5rem;
        min-width: 200px;
        align-items: stretch;
    }

    /* Consistent Button Styling */
    .btn-consistent {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        text-decoration: none;
        color: white;
        font-weight: 600;
        text-align: center;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
        width: 130px;
        height: 44px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        text-transform: none;
        letter-spacing: normal;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
    }

    .btn-consistent:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        opacity: 0.9;
        text-decoration: none;
        color: white;
    }

    .btn-consistent:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Button Colors - All Blue */
    .btn-booking { 
        background: #3498db; 
    }
    .btn-booking:hover { 
        background: #2980b9; 
    }

    .filter-label {
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #2c3e50;
        font-size: 0.9rem;
    }

    .filter-select, .filter-input {
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 0.9rem;
        width: 100%;
    }

    .results-info {
        background: #e8f4fd;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        color: #2c3e50;
    }

    /* 3 Columns City Grid Styles */
    .city-grid-3col {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-top: 2rem;
    }

    .city-card-3col {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #f0f0f0;
    }

    .city-card-3col:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .city-image-3col {
        width: 100%;
        height: 200px;
        background: #f8f9fa;
        overflow: hidden;
    }

    .city-image-3col img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .city-card-3col:hover .city-image-3col img {
        transform: scale(1.05);
    }

    .city-content-3col {
        padding: 1.2rem;
    }

    .city-title-3col {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: #2c3e50;
        font-weight: 600;
    }

    .hero-section {
        background-size: cover;
        background-position: center;
        color: white;
        text-align: center;
        padding: 4rem 0;
    }

    .hero-title {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .hero-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
    }

    /* Mobile Responsive for 3 Columns */
    @media (max-width: 1024px) {
        .city-grid-3col {
            grid-template-columns: repeat(2, 1fr);
            gap: 1.2rem;
        }
    }

    @media (max-width: 768px) {
        .city-grid-3col {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .city-image-3col {
            height: 180px;
        }

        .filter-grid-single-line {
            flex-direction: column;
        }

        .filter-group {
            min-width: 100%;
        }

        .button-group {
            min-width: 100%;
            flex-direction: row;
        }

        .btn-consistent {
            min-width: auto;
        }

        .hero-title {
            font-size: 2.5rem;
        }
    }

    @media (max-width: 480px) {
        .city-grid-3col {
            grid-template-columns: 1fr;
        }

        .city-content-3col {
            padding: 1rem;
        }

        .filter-grid-single-line {
            flex-direction: column;
        }

        .filter-group {
            min-width: 100%;
        }

        .hero-title {
            font-size: 2rem;
        }

        .hero-section {
            padding: 3rem 0;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum and maximum dates for check-in and check-out
    const today = new Date();
    const maxDate = new Date();
    maxDate.setFullYear(today.getFullYear() + 1); // One year from today
    const todayString = today.toISOString().split('T')[0];
    const maxDateString = maxDate.toISOString().split('T')[0];
    const checkInInput = document.querySelector('input[name="check_in"]');
    const checkOutInput = document.querySelector('input[name="check_out"]');

    // Set min and max attributes
    if (checkInInput) {
        checkInInput.min = todayString;
        checkInInput.max = maxDateString;

        // Add event listener to update check-out min date when check-in changes
        checkInInput.addEventListener('change', function() {
            if (checkOutInput) {
                checkOutInput.min = this.value;
                checkOutInput.max = maxDateString;

                // If check-out is before new check-in, clear it
                if (checkOutInput.value && checkOutInput.value < this.value) {
                    checkOutInput.value = '';
                }
            }
        });
    }

    if (checkOutInput) {
        checkOutInput.min = todayString;
        checkOutInput.max = maxDateString;

        // Add event listener to update check-in max date when check-out changes
        checkOutInput.addEventListener('change', function() {
            if (checkInInput && this.value) {
                const maxCheckIn = new Date(this.value);
                maxCheckIn.setDate(maxCheckIn.getDate() - 1);
                const maxCheckInString = maxCheckIn.toISOString().split('T')[0];

                checkInInput.max = maxCheckInString;

                // If check-in is after new check-out, clear it
                if (checkInInput.value && checkInInput.value > this.value) {
                    checkInInput.value = '';
                }
            }
        });
    }

    // Validate dates on form submission
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const checkInValue = checkInInput.value;
            const checkOutValue = checkOutInput.value;

            if (checkInValue && checkOutValue) {
                const checkInDate = new Date(checkInValue);
                const checkOutDate = new Date(checkOutValue);

                // Check if check-out is after check-in
                if (checkOutDate <= checkInDate) {
                    e.preventDefault();
                    alert('Check-out date must be after check-in date.');
                    return false;
                }

                // Check if dates are within allowed range
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const maxAllowedDate = new Date();
                maxAllowedDate.setFullYear(today.getFullYear() + 1);

                if (checkInDate < today || checkInDate > maxAllowedDate || checkOutDate > maxAllowedDate) {
                    e.preventDefault();
                    alert('Please select dates within the next year.');
                    return false;
                }
            }
        });
    }
});
</script>
{% endblock %}